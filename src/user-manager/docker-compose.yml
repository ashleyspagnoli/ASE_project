version: '3.8'

services:
  # 1. SERVIZIO DATABASE (MongoDB) - SENZA AUTENTICAZIONE
  mongodb:
    image: mongo:latest
    container_name: mongodb_container
    restart: always 
    ports:
      - "27017:27017" 
    volumes:
      # Volume per la persistenza dei dati: i dati andranno in ./data/mongo_data
      # Questo volume deve essere ELIMINATO con 'docker compose down -v' per resettare l'autenticazione.
      - mongo_data:/data/db 
    environment:
      # *** AUTENTICAZIONE TEMPORANEAMENTE RIMOSSA ***
      # MONGO_INITDB_ROOT_USERNAME: user_admin
      # MONGO_INITDB_ROOT_PASSWORD: secure_password
      MONGO_INITDB_DATABASE: user_data_db # <--- Il nome del tuo DB
      
  # 2. SERVIZIO BACKEND (Python FastAPI/Flask)
  backend:
    build: 
      context: ./backend 
    container_name: backend_endpoints
    ports:
      - "8000:8000"
    depends_on:
      - mongodb
    environment:
      # URI semplificato per connettersi senza utente/password
      MONGO_URI: mongodb://mongodb:27017/user_data_db # <-- URI SENZA CREDENZIALI
      
# Definizione dei Volumi
volumes:
  mongo_data: